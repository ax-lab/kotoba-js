# Project Configuration and Dependencies

This files describes the overall setup and dependencies for this project.

## Initial Setup

The entire initial setup and much of the dependencies and configuration are
explained in https://github.com/ax-lab/kana-js.

## Build scripts

This project uses npm scripts in `package.json` for most build commands. A
simple `Makefile` is provided with shortcuts to the main `npm` commands used
in the application.

All build artifacts are generated in the `build` directory:

* `build/coverage` result of test coverage. This is updated by `npm test`. An
  additional `coverage` command is provided to run tests and output coverage on
  the terminal. The `coverage` command also updates the HTML output.
* `build/main` contains the TypeScript compiler's output.
* `build/web` contains the result of the Webpack bundle.

The command `make clean` can be used to delete the `build` directory.

## Formatting and Linting

We adopt [ESLint](https://eslint.org) as our TypeScript linter. The main setup 
for TypeScript can be found [here](https://github.com/typescript-eslint/typescript-eslint#readme).

Additionally we include the following plugins:

* Import/Export linting:
	* https://github.com/benmosher/eslint-plugin-import
* Prettier support:
	* https://github.com/prettier/eslint-config-prettier
* Jest plugin:
	* https://github.com/jest-community/eslint-plugin-jest
* Downgrade errors to warnings
	* https://github.com/bfanger/eslint-plugin-only-warn

The secondary `tsconfig.eslint.json` is required to lint additional files that 
are not part of the compilation (e.g. test files). Files on the linter's path
that are not part of the project, and are not ignored by `ignorePatterns` 
in `.eslintrc` will generate a linting error.

Additionally, we are required to explicitly import Jest globals in Unit tests, 
otherwise ESLint does not recognize the Jest types and generates a bunch of 
spurious warnings due to `plugin:@typescript-eslint/recommended-requiring-type-checking`.

## Unit Testing & Code Coverage

Unit tests and code coverage use [Jest](https://jestjs.io/en/). Babel is 
required for TypeScript support.

Tests must manually include Jest globals to avoid linting errors. Example:

```typescript
import { expect, test } from '@jest/globals'
```

For some reason Eslint will not resolve Jest globals otherwise. This will 
result in spurious errors about unsafe calls and member access to the `Any` type.

## Configuration Files

* `cspell.json`
	* cSpell code spell checker configuration for the repository.
	* Main: https://github.com/streetsidesoftware/cspell
	* Docs: https://github.com/streetsidesoftware/cspell/tree/master/packages/cspell
* `.editorconfig`
	* Editor agnostic text file formatting configuration.
	* https://editorconfig.org/
	* Requires plugin for VSCode:
		* https://github.com/editorconfig/editorconfig-vscode
* `.eslintrc.json`
	* Linter configuration for ESLint.
	* https://eslint.org/docs/user-guide/configuring
	* Uses `tsconfig.eslint.json` as the starting point for TypeScript code.
* `.gitignore`
	* Ignore file for git. Based on the following:
		* https://github.com/github/gitignore
		* https://github.com/microsoft/TypeScript-Node-Starter/blob/master/.gitignore
* `.prettierignore` and `.prettierrc`
	* Prettier code formatting configuration.
	* https://prettier.io/docs/en/configuration.html
* `babel.config.js`
	* Babel configuration. We only use the minimal configuration necessary for Jest.
	* https://babeljs.io/docs/en/configuration
	* https://jestjs.io/docs/en/getting-started#using-babel
	* https://jestjs.io/docs/en/getting-started#using-typescript
* `jest.config.js`
	* Jest test running and code coverage configuration.
	* Generated from `jest --init` and mostly used as-is.
	* https://jestjs.io/docs/en/getting-started
* `package.json` and `package-lock.json`
	* npm configuration.
	* https://docs.npmjs.com/cli/v6/configuring-npm/package-json
* `tsconfig.json`
	* Main configuration for the TypeScript compiler (`tsc`).
	* Initially generated by `tsc --init`.
	* https://www.typescriptlang.org/tsconfig
* `tsconfig.eslint.json`
	* Additional configuration used only by ESLint to link additional files that 
	  are not part of the main TypeScript compilation (e.g. unit tests).
	* This extends `tsconfig.json` and specifies additional files.
	* Note that `includes` and `excludes` are actual [overrides](https://www.typescriptlang.org/tsconfig#extends), 
	  so they must be kept in-sync with the main config.
* `webpack.config.js`
	* Configuration for Webpack to generate the web bundle file.
	* Requires `ts-loader` for TypeScript support.
	* https://webpack.js.org/guides/typescript/


## Dependencies

_Describe any code dependencies and rationale for them. Provide links to repositories and documentation._

## Code Dependencies

* `Immutable.js` - provides better support for functional style programming.
	* https://immutable-js.github.io/immutable-js/

## Dev Dependencies

* `babel` - Required by Jest to use with Typescript.
	* https://jestjs.io/docs/en/getting-started#using-typescript
* `eslint` - Linter, including plugins and additional rules.
	* https://eslint.org/docs/user-guide/getting-started
* `jest` - Unit test framework. Includes code coverage.
	* https://jestjs.io/docs/en/getting-started
* `npm-run-all` - Used for the `run-s`/`run-p` commands in `package.json` 
  scripts. Allows running multiple npm commands in sequence or parallel.
	* https://github.com/mysticatea/npm-run-all
* `open-cli` - Used to open files from npm scripts
	* https://github.com/sindresorhus/open-cli
	* ISSUE: for some reason, using forward slashes in the path does not work
	  on Windows when inside `scripts`. Added a sequence of operations to cover
	  both cases.
* `prettier` - Code formatting.
	* https://prettier.io/
* `ts-loader` - TypeScript loader for Webpack.
	* https://github.com/TypeStrong/ts-loader
* `ts-node` - TypeScript execution and REPL for Node. Used by `npm start`.
	* https://github.com/TypeStrong/ts-node
* `typescript` - Actual TypeScript support.
	* https://github.com/microsoft/TypeScript
* `webpack` - Used to build the single file bundle for the web dist.
	* https://webpack.js.org/guides/getting-started/
* `types/jest` and `@types/node`
	* TypeScript's strong typed definitions for Jest and Node.
